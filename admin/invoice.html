<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¹Ø±Ø¶ Ø§Ù„ÙØ§ØªÙˆØ±Ø© â€“ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&display=swap" rel="stylesheet">

<style>
*{
  margin:0;padding:0;
  box-sizing:border-box;
  font-family:'Cairo',sans-serif;
}
body{
  background:#f4f7fb;
  color:#333;
  padding:20px;
}

/* ===== ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ===== */
.invoice-container{
  max-width:850px;
  margin:auto;
  background:#fff;
  padding:25px;
  border-radius:12px;
  box-shadow:0 3px 14px rgba(0,0,0,0.08);
}

/* Ø§Ù„Ø¹Ù†ÙˆØ§Ù† */
.invoice-title{
  text-align:center;
  font-size:26px;
  font-weight:800;
  color:#006b6a;
  margin-bottom:10px;
}

.invoice-sub{
  text-align:center;
  font-size:14px;
  color:#777;
  margin-bottom:20px;
}

/* Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ */
.info-box{
  margin-bottom:20px;
  padding:15px;
  background:#f8f8fa;
  border-radius:10px;
  border-right:4px solid #006b6a;
}

.info-row{
  display:flex;
  justify-content:space-between;
  margin-bottom:8px;
  font-size:15px;
}

/* Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£ØµÙ†Ø§Ù */
.items-table{
  width:100%;
  border-collapse:collapse;
  margin-top:20px;
}

.items-table th{
  background:#006b6a;
  color:#fff;
  padding:12px;
  font-size:14px;
}

.items-table td{
  padding:12px;
  background:#fff;
  border-bottom:1px solid #eee;
  font-size:14px;
  text-align:center;
}

/* ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ */
.total-box{
  margin-top:25px;
  padding:20px;
  background:#f8f8fa;
  border-radius:10px;
}

.total-row{
  display:flex;
  justify-content:space-between;
  margin-bottom:10px;
  font-size:16px;
  font-weight:600;
}

.total-final{
  color:#d60000;
  font-size:20px;
  font-weight:800;
}

/* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
.buttons{
  margin-top:25px;
  display:flex;
  gap:12px;
}

.btn{
  flex:1;
  padding:12px;
  text-align:center;
  border:none;
  border-radius:10px;
  font-size:15px;
  font-weight:700;
  cursor:pointer;
}

.print-btn{
  background:#8a004a;
  color:#fff;
}

.status-btn{
  background:#006b6a;
  color:#fff;
}

.delivery-btn{
  background:#009688;
  color:#fff;
}

.done-btn{
  background:#4CAF50;
  color:#fff;
}

/* Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© */
@media print {
  .buttons { display:none; }
  body { background:#fff; }
  .invoice-container{
    box-shadow:none;
    margin:0;
    padding:0;
  }
}
</style>

</head>
<body>

<div class="invoice-container">

  <div class="invoice-title">ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø·Ù„Ø¨</div>
  <div class="invoice-sub">Ù…ØªØ¬Ø± Ø¬Ù…Ø§Ù„Ùƒ â€“ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</div>

  <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ -->
  <div class="info-box" id="customerInfo">
    <!-- ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ù€ JS -->
  </div>

  <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£ØµÙ†Ø§Ù -->
  <table class="items-table" id="itemsTable">
    <thead>
      <tr>
        <th>Ø§Ù„ØµÙ†Ù</th>
        <th>Ø§Ù„Ø³Ø¹Ø± Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©</th>
        <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
        <th>Ø§Ù„Ø³Ø¹Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©</th>
        <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ -->
  <div class="total-box" id="totalsBox">
    <!-- ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡ Ø¨Ø§Ù„Ù€ JS -->
  </div>

  <!-- Ø§Ù„Ø£Ø²Ø±Ø§Ø± -->
  <div class="buttons">
    <button class="btn print-btn" onclick="window.print()">ğŸ–¨ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©</button>
    <button id="statusBtn" class="btn status-btn">Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ²</button>
    <button id="deliveryBtn" class="btn delivery-btn" style="display:none;">ğŸšš ØªÙ… Ø§Ù„Ø®Ø±ÙˆØ¬ Ù„Ù„ØªÙˆØµÙŠÙ„</button>
    <button id="doneBtn" class="btn done-btn" style="display:none;">âœ” Ù…ÙƒØªÙ…Ù„</button>
  </div>

</div>

<!-- JavaScript Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡ ÙÙŠ Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2 -->
<script>
// ======================= ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ ======================= //
let orders = JSON.parse(localStorage.getItem("orders") || "[]");
let invoiceId = localStorage.getItem("invoice_id");

if (!invoiceId) {
  alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙØ§ØªÙˆØ±Ø© Ù…Ø­Ø¯Ø¯Ø©");
  window.location.href = "orders.html";
}

let order = orders.find(o => o.id == invoiceId);

if (!order) {
  alert("Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨");
  window.location.href = "orders.html";
}

// Ø¥Ø°Ø§ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø§Ù„Ø© â†’ Ù†Ø¶Ø¹ "new"
if (!order.status) {
  order.status = "new";
  localStorage.setItem("orders", JSON.stringify(orders));
}

// ======================= ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© Ø¥Ù„Ù‰ Ù†Øµ Ø¹Ø±Ø¨ÙŠ ======================= //
function statusText(st) {
  switch (st) {
    case "new": return "Ø¬Ø¯ÙŠØ¯";
    case "processing": return "Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ²";
    case "delivery": return "Ø®Ø±Ø¬ Ù„Ù„ØªÙˆØµÙŠÙ„";
    case "completed": return "Ù…ÙƒØªÙ…Ù„";
    default: return "Ø¬Ø¯ÙŠØ¯";
  }
}

// ======================= Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ ======================= //
function renderCustomerInfo() {
  document.getElementById("customerInfo").innerHTML = `
    <div class="info-row"><span><b>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:</b></span> <span>#${order.id}</span></div>
    <div class="info-row"><span><b>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„:</b></span> <span>${order.customer_name}</span></div>
    <div class="info-row"><span><b>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„:</b></span> <span>${order.customer_phone}</span></div>
    <div class="info-row"><span><b>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨:</b></span> <span>${order.date}</span></div>
    <div class="info-row"><span><b>Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨:</b></span> 
      <span id="currentStatus" style="color:#006b6a;font-weight:700;">
        ${statusText(order.status)}
      </span>
    </div>
  `;
}

// ======================= Ø±Ø³Ù… Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙØ§ØªÙˆØ±Ø© ======================= //
function renderItems() {
  let tbody = document.querySelector("#itemsTable tbody");
  tbody.innerHTML = "";

  order.items.forEach(item => {
    let qty = item.qty || 1;
    let priceBefore = Number(item.base_price);
    let priceAfter = priceBefore * 1.15; // Ø¨Ø¹Ø¯ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©

    tbody.innerHTML += `
      <tr>
        <td>${item.name}</td>
        <td>${priceBefore.toFixed(2)} Ø±.Ø³</td>
        <td>${qty}</td>
        <td>${priceAfter.toFixed(2)} Ø±.Ø³</td>
        <td>${(priceAfter * qty).toFixed(2)} Ø±.Ø³</td>
      </tr>
    `;
  });
}

// ======================= Ø±Ø³Ù… Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ ======================= //
function renderTotals() {
  let subtotal = 0;

  order.items.forEach(i => {
    let qty = i.qty || 1;
    subtotal += (i.base_price * 1.15) * qty;
  });

  let vat = subtotal * 0.15;
  let total = subtotal + vat;

  // Ø­ÙØ¸ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø·Ù„Ø¨
  order.total = total.toFixed(2);
  localStorage.setItem("orders", JSON.stringify(orders));

  document.getElementById("totalsBox").innerHTML = `
    <div class="total-row"><span>Ø¹Ø¯Ø¯ Ø§Ù„Ø£ØµÙ†Ø§Ù:</span> <span>${order.items.length}</span></div>
    <div class="total-row"><span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©:</span> <span>${subtotal.toFixed(2)} Ø±.Ø³</span></div>
    <div class="total-row"><span>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© (15Ùª):</span> <span>${vat.toFixed(2)} Ø±.Ø³</span></div>
    <div class="total-row total-final"><span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</span> <span>${total.toFixed(2)} Ø±.Ø³</span></div>
  `;
}

// ======================= ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© ======================= //
function updateStatus(newStatus) {
  order.status = newStatus;
  localStorage.setItem("orders", JSON.stringify(orders));

  document.getElementById("currentStatus").innerText = statusText(newStatus);

  setupButtons();
  alert("âœ” ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨");
}

// ======================= ØªØ®ØµÙŠØµ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø© ======================= //
function setupButtons() {
  let st = order.status;

  document.getElementById("statusBtn").style.display = "none";
  document.getElementById("deliveryBtn").style.display = "none";
  document.getElementById("doneBtn").style.display = "none";

  if (st === "new") {
    statusBtn.style.display = "block"; // Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ²
  } else if (st === "processing") {
    deliveryBtn.style.display = "block"; // Ø®Ø±Ø¬ Ù„Ù„ØªÙˆØµÙŠÙ„
  } else if (st === "delivery") {
    doneBtn.style.display = "block"; // Ù…ÙƒØªÙ…Ù„
  }
}

// ======================= Ø±Ø¨Ø· Ø£Ø²Ø±Ø§Ø± ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø© ======================= //
document.getElementById("statusBtn").onclick = () => updateStatus("processing");
document.getElementById("deliveryBtn").onclick = () => updateStatus("delivery");
document.getElementById("doneBtn").onclick = () => updateStatus("completed");

// ======================= ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙØ­Ø© ======================= //
renderCustomerInfo();
renderItems();
renderTotals();
setupButtons();
</script>


</body>
</html>
